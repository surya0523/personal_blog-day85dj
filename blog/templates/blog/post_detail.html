{% extends 'blog/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<article>
    <h1 class="mt-4">{{ post.title }}</h1>
    <p class="text-muted">By {{ post.author.username }} on {{ post.created_on|date:"F d, Y" }}</p>
    {% if post.image %}
    <img src="{{ post.image.url }}" class="img-fluid mb-4" alt="{{ post.title }}">
    {% endif %}
    <div>
        {{ post.content|safe }}
    </div>
    <div class="mt-4">
        {% if post.category %}
        <span class="badge bg-secondary me-2"><a href="{% url 'category_filter' post.category.slug %}" class="text-white text-decoration-none">{{ post.category }}</a></span>
        {% endif %}
        {% for tag in post.tags.all %}
        <span class="badge bg-info me-2"><a href="{% url 'tag_filter' tag.slug %}" class="text-white text-decoration-none">{{ tag.name }}</a></span>
        {% endfor %}
    </div>

    {% if user.is_authenticated and user == post.author %}
    <div class="mt-3">
        <a href="{% url 'post_update' post.slug %}" class="btn btn-warning btn-sm">Edit Post</a>
        <a href="{% url 'post_delete' post.slug %}" class="btn btn-danger btn-sm">Delete Post</a>
    </div>
    {% endif %}
    
    <h3 class="mt-5">Comments ({{ comments|length }})</h3>
    {% for comment in comments %}
    <div class="card my-3">
        <div class="card-body">
            <h5 class="card-title">{{ comment.author.username }}</h5>
            <p class="card-text">{{ comment.content }}</p>
            <footer class="blockquote-footer">{{ comment.created_on|date:"F d, Y" }}</footer>
        </div>
    </div>
    {% empty %}
    <p>No comments yet.</p>
    {% endfor %}

    {% if user.is_authenticated %}
    <div class="mt-4">
        <h4>Leave a Comment</h4>
        <form method="post">
            {% csrf_token %}
            {{ comment_form|crispy }}
            <button type="submit" class="btn btn-primary mt-3">Submit Comment</button>
        </form>
    </div>
    {% else %}
    <p class="mt-4">Please <a href="{% url 'login' %}">log in</a> to leave a comment.</p>
    {% endif %}
</article>
{% endblock %}